(function(e){e.fn.typeshow=function(t){t=t?t:{};var n=e.extend({},e.fn.typeshow.defaults,t);this.each(function(){if(this.tagName==="DIV"){var t=e(this),r;r=e.metadata?e.extend({},n,t.metadata()):n;r.folder.length===0?r.folder="./":r.folder+="/";this.TypeShow=r;t.addClass("ts_typeshow");t.html(e.fn.typeshow.template);e.fn.typeshow.instances.push(this);var i=e.fn.typeshow.instances.length-1;t.data("TS_ID",i);e.fn.typeshow.isReady(this)?e.fn.typeshow.start(this):e.fn.typeshow.prepare(this)}});return this};e.fn.typeshow.defaults={folder:"",indexfile:"",text:"",fonts:[],themes:[],pangrams:[],settings:{},usePangrams:!0,allowExternalLinks:!0,settingsFile:"cache/setup.json",delay:800,onReady:function(){}};e.fn.typeshow.start=function(t){var n=t.TypeShow;n.text===""&&(n.text=e.fn.typeshow.getPangram(t));e(".ts_text",t).val(n.text);e.fn.typeshow.setFonts(t);e.fn.typeshow.setThemes(t);e("select.ts_dropdown_fonts",t).change(function(t){var n=e.fn.typeshow.getInstance(t.target),r=e(this).val(),i=n.TypeShow.fonts;e.each(i,function(t,i){if(i.name===r){e.fn.typeshow.setStyles(n,i.styles);n.TypeShow.settings.infolink.display==="Y"&&i.url!==""?e.fn.typeshow.setInfo(n,i):e(".ts_font_info").hide()}});e.fn.typeshow.update(!0)});e("select.ts_dropdown_styles",t).change(function(t){e.fn.typeshow.update(!0)});e("select.ts_dropdown_themes",t).change(function(t){e.fn.typeshow.update(!0)});e(".ts_text",t).change(function(t){var n=e.fn.typeshow.getInstance(t.target);e(this).val()!==n.TypeShow.text&&e.fn.typeshow.update(t)}).keyup(function(t){var n=e.fn.typeshow.getInstance(t.target);e(this).val()!==n.TypeShow.text&&e.fn.typeshow.update(t)}).focus(function(e){e.target.select()});e(".ts_image",t).attr("alt","TypeShow font sample is loading...");e.fn.typeshow.update(!0);n.onReady(t)};e.fn.typeshow.isReady=function(e){var t=e.TypeShow,n=t.usePangrams?t.pangrams.length>0:!0;return t.settings.dimensions&&t.fonts.length>0&&t.themes.length>0&&n};e.fn.typeshow.update=function(t,n){if(n===!0)for(var r=0;r<e.fn.typeshow.instances.length;r++){var i=e.fn.typeshow.instances[r];e(".ts_image",i).get(0).src=e.fn.typeshow.getImageSource(i);e(".ts_text",i).removeClass("loading")}else{var i=e.fn.typeshow.getInstance(t.target);e(".ts_text",i).addClass("loading");e.fn.typeshow.timer&&window.clearTimeout(e.fn.typeshow.timer);e.fn.typeshow.timer=window.setTimeout("$.fn.typeshow.update(null,true)",e.fn.typeshow.defaults.delay)}};e.fn.typeshow.getImageSource=function(t,n){n=n?n:e(".ts_text",t).val();if(n===""&&e.fn.typeshow.supportsSelect()){n=e.fn.typeshow.getPangram(t);e(".ts_text",t).val(n).select()}t.TypeShow.text=n;var r=new Date;return t.TypeShow.folder+t.TypeShow.indexfile+"?s="+encodeURIComponent(n)+"&font="+encodeURIComponent(e(".ts_dropdown_fonts",t).val())+"&style="+encodeURIComponent(e(".ts_dropdown_styles",t).val())+"&theme="+encodeURIComponent(e(".ts_dropdown_themes",t).val())+"&cache="+r.getHours()+r.getMinutes()+r.getSeconds()+r.getMilliseconds()};e.fn.typeshow.getPangram=function(e){var t=e.TypeShow;if(t.usePangrams&&t.pangrams.length>0){var n=t.pangrams[Math.round(Math.random()*(t.pangrams.length-1))];return n.text}return""};e.fn.typeshow.setFonts=function(t,n,r){r=r?r:t.TypeShow.settings.defaults.font;e.each(t.TypeShow.fonts,function(n,i){e("select.ts_dropdown_fonts",t).append('<option value="'+i.name+'" '+(r===i.name?'selected="selected"':"")+">"+i.name+"</option>");if(i.name===r){e.fn.typeshow.setStyles(t,i.styles);e.fn.typeshow.setInfo(t,i)}})};e.fn.typeshow.setStyles=function(t,n){n=n?n:[];var r=e(".ts_dropdown_styles",t).get(0),i=r.value||t.TypeShow.settings.defaults.style;while(r.firstChild)r.removeChild(r.firstChild);e.each(n,function(n,r){e("select.ts_dropdown_styles",t).append('<option value="'+r.name+'"'+(r.name===i?'selected="selected"':"")+">"+r.name+"</option>")})};e.fn.typeshow.setThemes=function(t,n){n=n?n:t.TypeShow.settings.defaults.theme;e.each(t.TypeShow.themes,function(r,i){e("select.ts_dropdown_themes",t).append('<option value="'+i.name+'"'+(n===i.name?'selected="slected"':"")+">"+i.name+"</option>")})};e.fn.typeshow.setInfo=function(t,n){var r=t.TypeShow.settings.infolink.description;r=e.fn.typeshow.replace(r,"%font%",n.name);r=e.fn.typeshow.replace(r,"%foundry%",n.foundry);r=e.fn.typeshow.replace(r,"%designer%",n.designer);e(".ts_font_info",t).html('<a href="'+n.url+'" class="ts_font_link">'+r+"</a>").show()};e.fn.typeshow.replace=function(e,t,n){e.indexOf(t)>=0&&(e=e.substr(0,e.indexOf(t))+n+e.substr(e.indexOf(t)+t.length));return e};e.fn.typeshow.prepare=function(t){var n=t.TypeShow;e.getJSON(n.folder+n.settingsFile,function(r){!n.settings.dimensions&&r.settings&&(n.settings=r.settings);n.fonts.length===0&&r.fonts&&(n.fonts=r.fonts);n.themes.length===0&&r.themes&&(n.themes=r.themes);n.pangrams.length===0&&r.pangrams&&(n.pangrams=r.pangrams);if(n.allowExternalLinks===!0){var i=e.fn.typeshow.getUrlParams();i["ts-font"]&&(n.settings.defaults.font=decodeURIComponent(i["ts-font"]));i["ts-style"]&&(n.settings.defaults.style=decodeURIComponent(i["ts-style"]));i["ts-theme"]&&(n.settings.defaults.theme=decodeURIComponent(i["ts-theme"]))}e.fn.typeshow.start(t)})};e.fn.typeshow.getInstance=function(t){var n=e(t).parents(".ts_typeshow").data("TS_ID");return e.fn.typeshow.instances[n]};e.fn.typeshow.resetAll=function(){e.fn.typeshow.instances=[];e.fn.typeshow.init=!1;e.fn.typeshow.timer=null};e.fn.typeshow.supportsSelect=function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("iphone")!==-1||e.indexOf("ipad")!==-1;return!t};e.fn.typeshow.getUrlParams=function(){var e=[],t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++){t=n[r].split("=");e.push(t[0]);e[t[0]]=t[1]}return e};e.fn.typeshow.instances=[];e.fn.typeshow.init=!1;e.fn.typeshow.timer=null;e.fn.typeshow.template='<img class="ts_image" alt="TypeShow requires JavaScript to be turned on in your browser." src="blanko"><form onsubmit="return false;" method="get" action="" class="ts_controls"><label for="ts_text"><span>Type here</span></label><input name="ts_text" type="text" class="ts_text" size="97" maxlength="97" value="" tabindex="0" /><div class="ts_fonts"><label for="ts_dropdown_fonts">Font</label><select class="ts_dropdown_fonts" tabindex="1"></select><select class="ts_dropdown_styles" tabindex="2"></select></div><div class="ts_themes"><label for="ts_dropdown_themes">Theme </label><select class="ts_dropdown_themes" tabindex="3"></select></div></form><div class="ts_font_info"></div><div class="ts_clear">'})(jQuery);